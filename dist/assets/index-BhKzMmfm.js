var X=Object.defineProperty;var Z=(a,e,l)=>e in a?X(a,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[e]=l;var o=(a,e,l)=>Z(a,typeof e!="symbol"?e+"":e,l);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const f of t)if(f.type==="childList")for(const n of f.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function l(t){const f={};return t.integrity&&(f.integrity=t.integrity),t.referrerPolicy&&(f.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?f.credentials="include":t.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function s(t){if(t.ep)return;t.ep=!0;const f=l(t);fetch(t.href,f)}})();let S=null;async function ee(){return S||(S=new AudioContext({latencyHint:"interactive"}),await S.resume()),S}function B(){return S}class ae{constructor(){o(this,"intervalId",null);o(this,"nextNoteTime",0);o(this,"currentStep",0);o(this,"scheduleAheadTime",.1);o(this,"tickInterval",25);o(this,"running",!1);o(this,"swing",0)}setSwing(e){this.swing=Math.max(0,Math.min(.75,e))}start(e,l,s){if(this.running)return;const t=60/l/4;this.nextNoteTime=e.currentTime,this.currentStep=0,this.running=!0,this.intervalId=window.setInterval(()=>{const f=e.currentTime+this.scheduleAheadTime;for(;this.nextNoteTime<f&&this.running;){const n=this.currentStep%2===1?this.swing*t*.5:0;s(this.currentStep,this.nextNoteTime+n),this.nextNoteTime+=t,this.currentStep=(this.currentStep+1)%16}},this.tickInterval)}stop(){this.running=!1,this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null)}getCurrentStep(){return this.currentStep}isRunning(){return this.running}}const se={level:1,tone:.5,decay:.35,tuning:1};function te(a,e,l={}){const s={...se,...l},t=new OscillatorNode(a,{type:"sine",frequency:150*s.tuning}),f=new BiquadFilterNode(a,{type:"lowpass",frequency:200+s.tone*800,Q:1}),n=new GainNode(a,{gain:s.level});t.connect(f).connect(n).connect(a.destination),t.frequency.setValueAtTime(150*s.tuning,e),t.frequency.exponentialRampToValueAtTime(50*s.tuning,e+.08),n.gain.setValueAtTime(s.level,e),n.gain.exponentialRampToValueAtTime(1e-4,e+s.decay),t.start(e),t.stop(e+s.decay+.1)}const le={level:1,tone:.5,snappy:.5,tuning:1};function fe(a,e,l={}){const s={...le,...l},t=new OscillatorNode(a,{type:"triangle",frequency:180*s.tuning}),f=new GainNode(a,{gain:.7*s.tone}),n=a.createBuffer(1,a.sampleRate*.2,a.sampleRate),r=n.getChannelData(0);for(let P=0;P<r.length;P++)r[P]=Math.random()*2-1;const i=new AudioBufferSourceNode(a,{buffer:n}),u=new BiquadFilterNode(a,{type:"highpass",frequency:1e3,Q:1}),g=new GainNode(a,{gain:.5*s.snappy});t.connect(f),i.connect(u).connect(g);const d=new GainNode(a,{gain:s.level});f.connect(d),g.connect(d),d.connect(a.destination),d.gain.setValueAtTime(s.level,e),d.gain.exponentialRampToValueAtTime(1e-4,e+.15),t.start(e),i.start(e),t.stop(e+.2)}function ne(a,e,l){const s=new OscillatorNode(a,{type:"sine",frequency:65}),t=new GainNode(a,{gain:1});s.connect(t).connect(a.destination),s.frequency.setValueAtTime(65,e),s.frequency.exponentialRampToValueAtTime(45,e+.1),t.gain.setValueAtTime(1,e),t.gain.exponentialRampToValueAtTime(1e-4,e+.4),s.start(e),s.stop(e+.5)}function re(a,e,l){const s=new OscillatorNode(a,{type:"sine",frequency:90}),t=new GainNode(a,{gain:1});s.connect(t).connect(a.destination),s.frequency.setValueAtTime(90,e),s.frequency.exponentialRampToValueAtTime(60,e+.08),t.gain.setValueAtTime(1,e),t.gain.exponentialRampToValueAtTime(1e-4,e+.35),s.start(e),s.stop(e+.4)}function ie(a,e,l){const s=new OscillatorNode(a,{type:"sine",frequency:130}),t=new GainNode(a,{gain:1});s.connect(t).connect(a.destination),s.frequency.setValueAtTime(130,e),s.frequency.exponentialRampToValueAtTime(90,e+.06),t.gain.setValueAtTime(1,e),t.gain.exponentialRampToValueAtTime(1e-4,e+.3),s.start(e),s.stop(e+.35)}function oe(a,e,l){const s=new OscillatorNode(a,{type:"square",frequency:180}),t=new OscillatorNode(a,{type:"square",frequency:330}),f=a.createBuffer(1,a.sampleRate*.05,a.sampleRate),n=f.getChannelData(0);for(let u=0;u<n.length;u++)n[u]=Math.random()*2-1;const r=new AudioBufferSourceNode(a,{buffer:f}),i=new GainNode(a,{gain:.8});s.connect(i),t.connect(i),r.connect(i),i.connect(a.destination),i.gain.setValueAtTime(.8,e),i.gain.exponentialRampToValueAtTime(1e-4,e+.05),s.start(e),t.start(e),r.start(e),s.stop(e+.06),t.stop(e+.06)}function ce(a,e,l){[0,.01,.02,.03].forEach(t=>{const f=a.createBuffer(1,a.sampleRate*.05,a.sampleRate),n=f.getChannelData(0);for(let d=0;d<n.length;d++)n[d]=Math.random()*2-1;const r=new AudioBufferSourceNode(a,{buffer:f}),i=new BiquadFilterNode(a,{type:"bandpass",frequency:2e3,Q:2}),u=new GainNode(a,{gain:.6});r.connect(i).connect(u).connect(a.destination);const g=e+t;u.gain.setValueAtTime(.6,g),u.gain.exponentialRampToValueAtTime(1e-4,g+.05),r.start(g)})}function ue(a,e,l){const s=a.createBuffer(1,a.sampleRate*.1,a.sampleRate),t=s.getChannelData(0);for(let i=0;i<t.length;i++)t[i]=Math.random()*2-1;const f=new AudioBufferSourceNode(a,{buffer:s}),n=new BiquadFilterNode(a,{type:"highpass",frequency:8e3,Q:1}),r=new GainNode(a,{gain:.7});f.connect(n).connect(r).connect(a.destination),r.gain.setValueAtTime(.7,e),r.gain.exponentialRampToValueAtTime(1e-4,e+.07),f.start(e)}function pe(a,e,l){const s=a.createBuffer(1,a.sampleRate*.3,a.sampleRate),t=s.getChannelData(0);for(let i=0;i<t.length;i++)t[i]=Math.random()*2-1;const f=new AudioBufferSourceNode(a,{buffer:s}),n=new BiquadFilterNode(a,{type:"highpass",frequency:8e3,Q:1}),r=new GainNode(a,{gain:.8});f.connect(n).connect(r).connect(a.destination),r.gain.setValueAtTime(.8,e),r.gain.exponentialRampToValueAtTime(1e-4,e+.2),f.start(e)}function de(a,e,l){const s=a.createBuffer(1,a.sampleRate*1,a.sampleRate),t=s.getChannelData(0);for(let i=0;i<t.length;i++)t[i]=Math.random()*2-1;const f=new AudioBufferSourceNode(a,{buffer:s}),n=new BiquadFilterNode(a,{type:"highpass",frequency:5e3,Q:1}),r=new GainNode(a,{gain:.6});f.connect(n).connect(r).connect(a.destination),r.gain.setValueAtTime(.6,e),r.gain.exponentialRampToValueAtTime(1e-4,e+.8),f.start(e)}function he(a,e,l){const s=a.createBuffer(1,a.sampleRate*.5,a.sampleRate),t=s.getChannelData(0);for(let i=0;i<t.length;i++)t[i]=Math.random()*2-1;const f=new AudioBufferSourceNode(a,{buffer:s}),n=new BiquadFilterNode(a,{type:"bandpass",frequency:8e3,Q:2}),r=new GainNode(a,{gain:.5});f.connect(n).connect(r).connect(a.destination),r.gain.setValueAtTime(.5,e),r.gain.exponentialRampToValueAtTime(1e-4,e+.4),f.start(e)}function ge(a,e,l){const s=new OscillatorNode(a,{type:"square",frequency:540}),t=new OscillatorNode(a,{type:"square",frequency:800}),f=new BiquadFilterNode(a,{type:"bandpass",frequency:800,Q:5}),n=new GainNode(a,{gain:.7});s.connect(f),t.connect(f),f.connect(n).connect(a.destination),n.gain.setValueAtTime(.7,e),n.gain.exponentialRampToValueAtTime(1e-4,e+.2),s.start(e),t.start(e),s.stop(e+.25),t.stop(e+.25)}class me{constructor(e,l){o(this,"playBtn");o(this,"stopBtn");o(this,"bpmSlider");o(this,"bpmDisplay");const s=document.getElementById(e);if(!s)throw new Error(`Container ${e} not found`);s.innerHTML=`
      <button id="play-btn" class="control-btn">▶ Play</button>
      <button id="stop-btn" class="control-btn">■ Stop</button>
    `,this.playBtn=s.querySelector("#play-btn"),this.stopBtn=s.querySelector("#stop-btn"),this.bpmSlider=document.getElementById("bpm-slider"),this.bpmDisplay=document.getElementById("bpm-display"),this.playBtn.addEventListener("click",async()=>{await ee(),l.onPlay(),this.setPlaying(!0)}),this.stopBtn.addEventListener("click",()=>{l.onStop(),this.setPlaying(!1)}),this.bpmSlider.addEventListener("input",()=>{const t=parseInt(this.bpmSlider.value,10);this.bpmDisplay.textContent=t.toString(),l.onBpmChange(t)})}setPlaying(e){this.playBtn.disabled=e,this.stopBtn.disabled=!e}getBpm(){return parseInt(this.bpmSlider.value,10)}}function b(a,e,l){const s=document.createElement(a);return e&&(s.className=e),l&&Object.entries(l).forEach(([t,f])=>{s.setAttribute(t,f)}),s}class ye{constructor(e,l){o(this,"container");o(this,"instruments",["BD","SD","LT","MT","HT","RS","CP","CH","OH","CY","RD","CB"]);const s=document.getElementById(e);if(!s)throw new Error(`Container ${e} not found`);this.container=s,this.render(l)}render(e){this.container.innerHTML="";const l=b("div","sequencer-header"),s=b("div","instrument-spacer");l.appendChild(s);for(let t=0;t<16;t++){const f=b("div","step-index");f.textContent=((t+1)%16).toString(),f.setAttribute("data-step",String(t)),l.appendChild(f)}this.container.appendChild(l),this.instruments.forEach(t=>{const f=b("div","sequencer-row"),n=b("div","instrument-label",{"data-instrument":t});n.textContent=t,f.appendChild(n);for(let r=0;r<16;r++){const i=b("button","step-button",{"data-instrument":t,"data-step":r.toString()});f.appendChild(i)}this.container.appendChild(f)}),this.container.addEventListener("click",t=>{const f=t.target;if(f.classList.contains("step-button")){const n=f.dataset.instrument,r=parseInt(f.dataset.step,10);f.classList.toggle("active"),e.onStepToggle(n,r)}})}highlightStep(e){this.container.querySelectorAll(".step-button").forEach(s=>{const t=parseInt(s.dataset.step,10);s.classList.toggle("current",t===e)})}setStepActive(e,l,s){const t=this.container.querySelector(`[data-instrument="${e}"][data-step="${l}"]`);t&&t.classList.toggle("active",s)}}class be{constructor(e){o(this,"rafId",null);o(this,"onStepChange");o(this,"bpm");o(this,"startTime",0);o(this,"tick",()=>{const e=B();if(!e)return;const l=60/this.bpm/4,s=e.currentTime-this.startTime,t=Math.floor(s/l)%16;this.onStepChange(t),this.rafId=requestAnimationFrame(this.tick)});this.onStepChange=e,this.bpm=120}start(e){this.bpm=e;const l=B();l&&(this.startTime=l.currentTime,this.tick())}stop(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null)}}const Se={BD:{level:1,tone:.5,decay:.35,tuning:1},SD:{level:1,tone:.5,snappy:.5,tuning:1},LT:{level:.9,tuning:1,decay:.4},MT:{level:.9,tuning:1,decay:.35},HT:{level:.9,tuning:1,decay:.3},RS:{level:.8},CP:{level:.6},CH:{level:.7,decay:.07},OH:{level:.8,decay:.2},CY:{level:.6,tone:.5,decay:.8},RD:{level:.5,tone:.5,decay:.4},CB:{level:.7}},h=JSON.parse(JSON.stringify(Se));class ve{constructor(e){o(this,"container");o(this,"currentVoice","BD");const l=document.getElementById(e);if(!l)throw new Error(`Container ${e} not found`);this.container=l,this.render()}selectVoice(e){this.currentVoice=e,this.render()}render(){const e=h[this.currentVoice];e&&(this.container.innerHTML=`
      <div class="voice-params-panel">
        <h3 class="panel-title">${this.currentVoice} Parameters</h3>
        <div class="params-grid">
          ${Object.entries(e).map(([l,s])=>`
            <div class="param-control">
              <label>${l}</label>
              <input type="range" 
                     min="${this.getMin(l)}" 
                     max="${this.getMax(l)}" 
                     step="0.01"
                     value="${s}" 
                     data-voice="${this.currentVoice}"
                     data-param="${l}">
              <span class="param-value">${s.toFixed(2)}</span>
            </div>
          `).join("")}
        </div>
      </div>
    `,this.attachEvents())}getMin(e){return e==="tuning"?.5:0}getMax(e){return e==="tuning"?2:1}attachEvents(){this.container.querySelectorAll('input[type="range"]').forEach(e=>{e.addEventListener("input",l=>{const s=l.target,t=s.dataset.voice,f=s.dataset.param,n=parseFloat(s.value);h[t][f]=n;const r=s.nextElementSibling;r&&(r.textContent=n.toFixed(2))})})}}class Te{constructor(e){o(this,"container");o(this,"voices",["BD","SD","LT","MT","HT","RS","CP","CH","OH","CY","RD","CB"]);const l=document.getElementById(e);if(!l)throw new Error(`Container ${e} not found`);this.container=l,this.render(),this.attachEvents()}render(){this.container.innerHTML=`
      <div class="mixer-strip">
        ${this.voices.map(e=>`
          <div class="voice-control" data-voice="${e}">
            <span class="voice-name">${e}</span>
            <input type="range" 
                   min="0" 
                   max="1" 
                   step="0.01" 
                   value="${h[e].level}" 
                   class="voice-slider"
                   data-voice="${e}">
            <span class="voice-level">${Math.round(h[e].level*100)}%</span>
          </div>
        `).join("")}
      </div>
    `}attachEvents(){this.container.querySelectorAll(".voice-slider").forEach(l=>{l.addEventListener("input",s=>{var i;const t=s.target,f=t.dataset.voice,n=parseFloat(t.value);this.updateVoiceLevel(f,n);const r=(i=t.parentElement)==null?void 0:i.querySelector(".voice-level");r&&(r.textContent=`${Math.round(n*100)}%`)})})}updateVoiceLevel(e,l){if(e in h){const s=e;"level"in h[s]&&(h[s].level=l)}}}class Ce{constructor(e,l){o(this,"container");o(this,"currentPattern","A");o(this,"onSelect");const s=document.getElementById(e);if(!s)throw new Error(`Container ${e} not found`);this.container=s,this.onSelect=l,this.render(),this.attachKeyboard()}setCurrentPattern(e){this.currentPattern=e,this.updateUI()}render(){this.container.innerHTML=`
      <div class="pattern-selector">
        <div class="pattern-buttons">
          ${["A","B","C","D","E","F","G","H"].map(e=>`
            <button class="pattern-btn ${e===this.currentPattern?"active":""}" 
                    data-pattern="${e}">${e}</button>
          `).join("")}
        </div>
        <div class="pattern-actions">
          <button class="action-btn" id="copy-pattern" title="Copy (Ctrl+C)">
            <i class="ph ph-copy"></i>
          </button>
          <button class="action-btn" id="paste-pattern" title="Paste (Ctrl+V)">
            <i class="ph ph-clipboard"></i>
          </button>
          <button class="action-btn" id="clear-pattern" title="Clear">
            <i class="ph ph-trash"></i>
          </button>
        </div>
      </div>
    `,this.attachEvents()}attachEvents(){var e,l,s;this.container.querySelectorAll(".pattern-btn").forEach(t=>{t.addEventListener("click",()=>{const f=t.dataset.pattern;f&&this.selectPattern(f)})}),(e=document.getElementById("copy-pattern"))==null||e.addEventListener("click",()=>{this.container.dispatchEvent(new CustomEvent("copy"))}),(l=document.getElementById("paste-pattern"))==null||l.addEventListener("click",()=>{this.container.dispatchEvent(new CustomEvent("paste"))}),(s=document.getElementById("clear-pattern"))==null||s.addEventListener("click",()=>{confirm(`Clear pattern ${this.currentPattern}?`)&&this.container.dispatchEvent(new CustomEvent("clear"))})}attachKeyboard(){document.addEventListener("keydown",e=>{if(!(e.target instanceof HTMLInputElement)){if(e.key>="1"&&e.key<="8"){const l=["A","B","C","D","E","F","G","H"],s=parseInt(e.key,10)-1,t=l[s];t&&this.selectPattern(t);return}if(e.ctrlKey&&e.key==="c"){e.preventDefault(),this.container.dispatchEvent(new CustomEvent("copy"));return}e.ctrlKey&&e.key==="v"&&(e.preventDefault(),this.container.dispatchEvent(new CustomEvent("paste")))}})}selectPattern(e){this.currentPattern=e,this.onSelect(e),this.updateUI()}updateUI(){this.container.querySelectorAll(".pattern-btn").forEach(e=>{const l=e.dataset.pattern;l&&e.classList.toggle("active",l===this.currentPattern)})}}function we(){return{name:"Untitled",bpm:120,steps:{BD:Array(16).fill(!1),SD:Array(16).fill(!1),LT:Array(16).fill(!1),MT:Array(16).fill(!1),HT:Array(16).fill(!1),RS:Array(16).fill(!1),CP:Array(16).fill(!1),CH:Array(16).fill(!1),OH:Array(16).fill(!1),CY:Array(16).fill(!1),RD:Array(16).fill(!1),CB:Array(16).fill(!1)}}}function K(){return{name:"Atmospheric UK Garage — Classic 2‑Step",bpm:134,swing:.55,steps:{BD:[!0,!1,!1,!1,!1,!1,!0,!1,!1,!1,!0,!1,!1,!1,!1,!1],SD:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],LT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],MT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],HT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RS:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1],CP:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],CH:[!0,!1,!0,!0,!1,!1,!0,!1,!0,!1,!0,!0,!1,!1,!0,!1],OH:[!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!0,!1,!1,!1,!1,!1],CY:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RD:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],CB:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]}}}const Y={A:K(),B:{name:"UKG — Skippy Hats",bpm:134,swing:.6,steps:{BD:[!0,!1,!1,!1,!1,!0,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1],SD:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],LT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],MT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],HT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RS:[!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1],CP:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],CH:[!0,!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!0,!1,!0,!1,!0],OH:[!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!0,!1,!1,!1,!1,!1],CY:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RD:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],CB:[!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1]}},C:{name:"UKG — Deep Sub Roll",bpm:132,swing:.55,steps:{BD:[!0,!1,!1,!1,!1,!1,!0,!1,!0,!1,!1,!1,!1,!0,!1,!1],SD:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],LT:[!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!1,!1],MT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1],HT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RS:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1],CP:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],CH:[!0,!1,!0,!0,!1,!1,!0,!1,!0,!1,!0,!0,!1,!1,!0,!1],OH:[!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!0,!1,!1],CY:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RD:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],CB:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1]}},D:{name:"UKG — Ghost Snare & Rim",bpm:134,swing:.58,steps:{BD:[!0,!1,!1,!1,!1,!0,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1],SD:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],LT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],MT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],HT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RS:[!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1],CP:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],CH:[!0,!1,!0,!0,!1,!1,!0,!1,!0,!1,!0,!0,!1,!1,!0,!1],OH:[!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!0,!1,!1,!1,!1,!1],CY:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RD:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],CB:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1]}},E:{name:"UKG — Wide OH Shuffle",bpm:136,swing:.55,steps:{BD:[!0,!1,!1,!1,!1,!1,!0,!1,!0,!1,!1,!1,!1,!0,!1,!1],SD:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],LT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],MT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],HT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RS:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1],CP:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],CH:[!0,!1,!0,!1,!0,!1,!0,!1,!0,!1,!0,!1,!0,!1,!0,!1],OH:[!1,!1,!1,!0,!1,!1,!1,!0,!1,!1,!1,!0,!1,!1,!1,!0],CY:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RD:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],CB:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1]}},F:{name:"UKG — Break‑Step Accents",bpm:135,swing:.6,steps:{BD:[!0,!1,!1,!1,!1,!0,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1],SD:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],LT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],MT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],HT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RS:[!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1],CP:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],CH:[!0,!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!0,!1,!0,!1,!0],OH:[!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!0,!1,!1,!1,!1,!1],CY:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RD:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],CB:[!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1]}},G:{name:"UKG — Dark Garage",bpm:132,swing:.62,steps:{BD:[!0,!1,!1,!1,!1,!1,!0,!1,!1,!1,!0,!1,!1,!1,!1,!1],SD:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],LT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],MT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],HT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RS:[!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1],CP:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],CH:[!0,!1,!1,!0,!1,!0,!1,!1,!0,!1,!1,!0,!1,!1,!0,!1],OH:[!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!0,!1,!1],CY:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RD:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],CB:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1]}},H:{name:"UKG — Dubby Minimal",bpm:130,swing:.54,steps:{BD:[!0,!1,!1,!1,!1,!0,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1],SD:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],LT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],MT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],HT:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RS:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1],CP:[!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1],CH:[!0,!1,!0,!0,!1,!1,!0,!1,!0,!1,!0,!0,!1,!1,!0,!1],OH:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!0],CY:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],RD:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1],CB:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1]}}};function Be(a,e,l){return{...a,steps:{...a.steps,[e]:a.steps[e].map((s,t)=>t===l?!s:s)}}}const U="tr808:v1:bank";function y(a){try{const e=JSON.stringify(a);localStorage.setItem(U,e)}catch(e){e instanceof DOMException&&e.name==="QuotaExceededError"?console.error("localStorage quota exceeded"):console.error("Failed to save bank:",e)}}function _(){try{const a=localStorage.getItem(U);if(!a)return null;const e=JSON.parse(a);return!e.patterns||!e.currentPattern?(console.error("Invalid bank structure"),null):e}catch(a){return console.error("Failed to load bank:",a),null}}class Ee{constructor(){o(this,"state");o(this,"listeners",new Set);const l=_()??{patterns:JSON.parse(JSON.stringify(Y)),currentPattern:"A"},s=l.patterns[l.currentPattern]??K();this.state={bank:l,playback:{isPlaying:!1,currentStep:0,bpm:s.bpm}}}getState(){return this.state}getCurrentPattern(){return this.state.bank.patterns[this.state.bank.currentPattern]}setCurrentPattern(e){this.state.bank.patterns[e]&&(this.state={...this.state,bank:{...this.state.bank,currentPattern:e},playback:{...this.state.playback,bpm:this.state.bank.patterns[e].bpm}},y(this.state.bank),this.notify())}setBank(e){this.state={...this.state,bank:e},y(e),this.notify()}toggleStep(e,l){const s=this.state.bank.currentPattern,t=this.state.bank.patterns[s];if(!t)return;const f=t.steps[e].slice();f[l]=!f[l];const n={...t,steps:{...t.steps,[e]:f}},r={...this.state.bank,patterns:{...this.state.bank.patterns,[s]:n}};this.state={...this.state,bank:r},y(r),this.notify()}setState(e){this.state={...this.state,...e},this.notify()}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e(this.state))}}const c=new Ee,m=new ae,H={BD:te,SD:fe,LT:ne,MT:re,HT:ie,RS:oe,CP:ce,CH:ue,OH:pe,CY:de,RD:he,CB:ge},L=_();L&&c.setState({bank:L});const E=new ye("sequencer",{onStepToggle:(a,e)=>{const l=c.getState(),s=l.bank.patterns[l.bank.currentPattern];if(!s)return;const t=Be(s,a,e);l.bank.patterns[l.bank.currentPattern]=t,c.setState({bank:l.bank}),y(l.bank)}}),ke=new ve("voice-params");new Te("mixer");const Pe=new Ce("pattern-selector",a=>{const e=c.getState();e.bank.currentPattern=a,c.setState({bank:e.bank}),C(),y(e.bank)});let R=null;var q;(q=document.getElementById("pattern-selector"))==null||q.addEventListener("copy",()=>{const a=c.getState();R=JSON.parse(JSON.stringify(a.bank.patterns[a.bank.currentPattern])),p(`Copied pattern ${a.bank.currentPattern}`)});var O;(O=document.getElementById("pattern-selector"))==null||O.addEventListener("paste",()=>{if(!R){p("Nothing to paste");return}const a=c.getState();a.bank.patterns[a.bank.currentPattern]=JSON.parse(JSON.stringify(R)),c.setState({bank:a.bank}),y(a.bank),C(),p(`Pasted to pattern ${a.bank.currentPattern}`)});var M;(M=document.getElementById("pattern-selector"))==null||M.addEventListener("clear",()=>{const a=c.getState();a.bank.patterns[a.bank.currentPattern]=we(),c.setState({bank:a.bank}),y(a.bank),C(),p(`Cleared pattern ${a.bank.currentPattern}`)});document.addEventListener("click",a=>{var l;const e=a.target;if(e.classList.contains("instrument-label")){const s=(l=e.textContent)==null?void 0:l.trim();s&&ke.selectVoice(s)}});function C(){const a=c.getState(),e=a.bank.patterns[a.bank.currentPattern];if(!e)return;Object.keys(e.steps).forEach(n=>{for(let r=0;r<16;r++)E.setStepActive(n,r,!1)}),Object.entries(e.steps).forEach(([n,r])=>{r.forEach((i,u)=>{i&&E.setStepActive(n,u,!0)})});const l=document.getElementById("bpm-slider"),s=document.getElementById("bpm-display");l&&s&&(l.value=e.bpm.toString(),s.textContent=e.bpm.toString());const t=document.getElementById("swing-slider"),f=document.getElementById("swing-display");if(e.swing!=null&&t&&f){const n=Math.round((e.swing??0)*100);t.value=String(n),f.textContent=`${n}%`,m.setSwing(e.swing??0)}Pe.setCurrentPattern(a.bank.currentPattern),p(`Pattern ${a.bank.currentPattern}: ${e.name}`)}function J(){const a={patterns:JSON.parse(JSON.stringify(Y)),currentPattern:"A"};c.setState({bank:a}),y(c.getState().bank),C()}C();const v=new be(a=>{E.highlightStep(a)}),N=new me("controls",{onPlay:()=>{const a=B();if(!a)return;const e=N.getBpm();m.start(a,e,(l,s)=>{const t=c.getState(),f=t.bank.patterns[t.bank.currentPattern];f&&Object.entries(f.steps).forEach(([n,r])=>{if(r[l]){const i=H[n],u=h[n];i(a,s,u)}})}),v.start(e),c.setState({playback:{isPlaying:!0,currentStep:0,bpm:e}}),p("Playing")},onStop:()=>{m.stop(),v.stop(),E.highlightStep(-1),c.setState({playback:{isPlaying:!1,currentStep:0,bpm:N.getBpm()}}),p("Stopped")},onBpmChange:a=>{const e=c.getState();if(e.playback.isPlaying){m.stop(),v.stop();const l=B();l&&(m.start(l,a,(s,t)=>{const f=c.getState(),n=f.bank.patterns[f.bank.currentPattern];n&&Object.entries(n.steps).forEach(([r,i])=>{if(i[s]){const u=H[r],g=h[r];u(l,t,g)}})}),v.start(a))}c.setState({playback:{...e.playback,bpm:a}})}}),T=document.getElementById("swing-slider"),j=document.getElementById("swing-display");{const a=parseInt(T.value,10)/100;j.textContent=`${T.value}%`,m.setSwing(a)}T.addEventListener("input",()=>{const a=parseInt(T.value,10)/100;j.textContent=`${T.value}%`,m.setSwing(a)});document.addEventListener("keydown",a=>{var e;if(!(a.target instanceof HTMLInputElement)){if(a.key===" "){a.preventDefault(),c.getState().playback.isPlaying?(N.setPlaying(!1),m.stop(),v.stop(),p("Stopped")):(e=document.getElementById("play-btn"))==null||e.click();return}if(a.key==="+"||a.key==="="){a.preventDefault(),I(5);return}if(a.key==="-"||a.key==="_"){a.preventDefault(),I(-5);return}if(a.key==="?"){a.preventDefault(),Q();return}if(a.key==="Escape"){z();return}if(a.key==="t"||a.key==="T"){a.preventDefault(),x();return}(a.key==="d"||a.key==="D")&&(a.preventDefault(),J())}});function I(a){const e=document.getElementById("bpm-slider"),l=parseInt(e.value,10),s=Math.max(60,Math.min(240,l+a));e.value=s.toString();const t=new window.Event("input");e.dispatchEvent(t)}function Q(){const a=document.getElementById("help-overlay");a==null||a.classList.toggle("visible")}function z(){const a=document.getElementById("help-overlay");a==null||a.classList.remove("visible")}function x(){const a=document.documentElement,l=a.getAttribute("data-theme")==="dark"?"light":"dark";a.setAttribute("data-theme",l);const s=document.getElementById("theme-toggle");if(s){const t=s.querySelector("i");t&&(t.className=l==="dark"?"ph ph-moon":"ph ph-sun")}}function p(a){const e=document.getElementById("status-text");e&&(e.textContent=a)}let A=window.performance.now(),D=0;function W(){D++;const a=window.performance.now();if(a-A>=1e3){const e=Math.round(D*1e3/(a-A)),l=document.getElementById("perf-text");l&&(l.textContent=`FPS: ${e}`),D=0,A=a}requestAnimationFrame(W)}const k=c.getState(),w=k.bank.patterns[k.bank.currentPattern];w?(p(`Ready - Pattern ${k.bank.currentPattern}: ${w.name}`),console.log(`TR-808 initialized - Pattern ${k.bank.currentPattern}: ${w.name} @ ${w.bpm} BPM`)):(p("Ready"),console.log("TR-808 initialized"));requestAnimationFrame(W);var V;(V=document.getElementById("help-btn"))==null||V.addEventListener("click",Q);var $;($=document.getElementById("theme-toggle"))==null||$.addEventListener("click",x);var G;(G=document.getElementById("default-pattern-btn"))==null||G.addEventListener("click",J);var F;(F=document.getElementById("help-overlay"))==null||F.addEventListener("click",a=>{a.target===a.currentTarget&&z()});console.log("12 voices with parameters: BD, SD, LT, MT, HT, RS, CP, CH, OH, CY, RD, CB");console.log("Click voice label to edit parameters");console.log("Press ? for shortcuts, D for default pattern");
